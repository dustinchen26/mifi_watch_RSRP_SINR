<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>數據解析器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 300px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
    }
    table {
      width: auto;
      border-collapse: collapse;
      margin-top: 20px;
      table-layout: auto; /* 讓表格寬度根據內容自動調整 */
    }
    th, td {
      padding: 5px 10px; /* 減少內邊距，讓表格更緊湊 */
      text-align: left; /* 讓內容左對齊 */
      border: 1px solid #ccc;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>

<h1>數據解析器</h1>
<textarea id="inputText" placeholder="請在此處輸入數據..."></textarea><br>
<button onclick="parseData()">解析數據</button>

<table id="outputTable">
  <thead>
    <tr>
      <th>Time</th>
      <th>RSRP</th>
      <th>SINR</th>
      <th>RX0</th>
      <th>RX1</th>
      <th>RX2</th>
      <th>RX3</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<script>
  function parseData() {
    const inputText = document.getElementById('inputText').value.trim();
    const lines = inputText.split('\n').filter(line => line.trim() !== '');

    let output = '';
    let time1 = '';
    let rsrpAndSinr = '';
    let rxData = { rx0: '', rx1: '', rx2: '', rx3: '' };

    // 清空表格
    const tbody = document.querySelector('#outputTable tbody');
    tbody.innerHTML = '';

    for (let i = 0; i < lines.length; i++) {
      const line = lines[i].trim();

      // 解析時間格式 (例如：2024-11-24 08:04:12)
      const timeMatch = line.match(/(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})/);
      if (timeMatch) {
        time1 = timeMatch[1];
      }

      // 解析 RSRP 和 SINR (例如：RSRQ -11 dB, RSRP -78 dBm, SINR 32 dB)
      const rsrpSinrMatch = line.match(/RSRQ\s*(-?\d+)\s*dB,\s*RSRP\s*(-?\d+)\s*dBm,\s*SINR\s*(-?\d+)\s*dB/);
      if (rsrpSinrMatch) {
        rsrpAndSinr = `RSRP ${rsrpSinrMatch[2]} dBm, SINR ${rsrpSinrMatch[3]} dB`;
      }

      // 解析 RX0 到 RX3 的數據
      const rxMatch = line.match(/(RX[0-3])\s*power:\s*(-?\d+)\s*dBm,.*rsrp:\s*(-?\d+)\s*dBm/);
      if (rxMatch) {
        const rxIndex = rxMatch[1].toLowerCase(); // RX0, RX1, RX2, RX3
        const rsrpValue = rxMatch[3];
        if (rxIndex === 'rx0') {
          rxData.rx0 = `RX0 rsrp: ${rsrpValue} dBm`;
        } else if (rxIndex === 'rx1') {
          rxData.rx1 = `RX1 rsrp: ${rsrpValue} dBm`;
        } else if (rxIndex === 'rx2') {
          rxData.rx2 = `RX2 rsrp: ${rsrpValue} dBm`;
        } else if (rxIndex === 'rx3') {
          rxData.rx3 = `RX3 rsrp: ${rsrpValue} dBm`;
        }
      }

      // 每次處理完一行後，如果我們已經有所有的數據，組裝並顯示
      if (time1 && rsrpAndSinr && rxData.rx0 && rxData.rx1 && rxData.rx2 && rxData.rx3) {
        // 創建新行並添加至表格
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td>${time1}</td>
          <td>${rsrpAndSinr.split(', ')[0]}</td>
          <td>${rsrpAndSinr.split(', ')[1]}</td>
          <td>${rxData.rx0}</td>
          <td>${rxData.rx1}</td>
          <td>${rxData.rx2}</td>
          <td>${rxData.rx3}</td>
        `;
        tbody.appendChild(newRow);

        // 重置數據以便處理下一組數據
        time1 = rsrpAndSinr = '';
        rxData = { rx0: '', rx1: '', rx2: '', rx3: '' };
      }
    }

    if (tbody.innerHTML === '') {
      tbody.innerHTML = '<tr><td colspan="7">未能解析出任何有效數據。</td></tr>';
    }
  }
</script>

</body>
</html>
